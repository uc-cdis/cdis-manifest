mappings:
  - name: midrcstaging_dataset
    doc_type: dataset
    type: aggregator
    root: dataset
    props:
      - name: project_id
      - name: submitter_id
      - name: data_contributor
      - name: data_description
      - name: data_url_doi
      - name: research_description
      - name: license
      - name: publication_citation
      - name: data_citation
    aggregated_props:
      - name: _imaging_study_id
        path: cases.imaging_studies
        src: id
        fn: min
      - name: _cases_count
        path: cases
        fn: count
      - name: _imaging_studies_count
        path: cases.imaging_studies
        fn: count
      - name: _ct_series_file_count
        path: cases.imaging_studies.ct_series_files
        fn: count
      - name: _cr_series_file_count
        path: cases.imaging_studies.cr_series_files
        fn: count
      - name: _dx_series_file_count
        path: cases.imaging_studies.dx_series_files
        fn: count
      - name: _mr_series_file_count
        path: cases.imaging_studies.mr_series_files
        fn: count
    joining_props:
      - index: imaging_data_file
        join_on: _dataset_id
        props:
          - name: object_id
            src: object_id
            fn: set
          - name: file_name
            src: file_name
            fn: set
          - name: data_format
            src: data_format
            fn: set
          - name: data_type
            src: data_type
            fn: set
          - name: data_category
            src: data_category
            fn: set
    parent_props:
      - path: projects[project_code:code,project_name:name,project_investigator_affiliation:investigator_affiliation]
  - name: midrcstaging_case
    doc_type: case
    type: aggregator
    root: case
    props:
      - name: project_id
      - name: submitter_id
      - name: sex
      - name: race
      - name: age_at_index
      - name: index_event
      - name: zip
      - name: covid19_positive
    aggregated_props:
      - name: _imaging_studies_count
        path: imaging_studies
        fn: count
      - name: _ct_series_file_count
        path: imaging_studies.ct_series_files
        fn: count
      - name: _cr_series_file_count
        path: imaging_studies.cr_series_files
        fn: count
      - name: _dx_series_file_count
        path: imaging_studies.dx_series_files
        fn: count
      - name: _mr_series_file_count
        path: imaging_studies.mr_series_files
        fn: count
    parent_props:
      - path: datasets[dataset_submitter_id:submitter_id]
    joining_props:
      - index: imaging_data_file
        join_on: _case_id
        props:
          - name: object_id
            src: object_id
            fn: set
          - name: file_name
            src: file_name
            fn: set
          - name: data_format
            src: data_format
            fn: set
          - name: data_type
            src: data_type
            fn: set
          - name: data_category
            src: data_category
            fn: set
  - name: midrcstaging_imaging_study
    doc_type: imaging_study
    type: aggregator
    root: imaging_study
    props:
      - name: project_id
      - name: submitter_id
      - name: study_modality
      - name: study_description
      - name: age_at_imaging
      - name: days_to_study
      - name: body_part_examined
      - name: study_location
      - name: study_year
      - name: study_year_shifted
      - name: study_uid
      - name: case_ids
    aggregated_props:
      - name: _ct_series_file_count
        path: ct_series_files
        fn: count
      - name: _cr_series_file_count
        path: cr_series_files
        fn: count
      - name: _dx_series_file_count
        path: dx_series_files
        fn: count
      - name: _mr_series_file_count
        path: mr_series_files
        fn: count
    parent_props:
      - path: cases[case_submitter_id:submitter_id,sex,race,age_at_index,index_event,zip,covid19_positive].datasets[data_contributor]
    joining_props:
      - index: imaging_data_file
        join_on: _imaging_study_id
        props:
          - name: object_id
            src: object_id
            fn: set
          - name: file_name
            src: file_name
            fn: set
          - name: data_format
            src: data_format
            fn: set
          - name: data_type
            src: data_type
            fn: set
          - name: data_category
            src: data_category
            fn: set
  - name: midrcstaging_imaging_data_file
    doc_type: imaging_data_file
    type: collector
    root: None
    category: imaging_data_file
    props:
      - name: submitter_id
      - name: object_id
      - name: md5sum
      - name: file_name
      - name: file_size
      - name: data_format
      - name: data_type
      - name: data_category
      - name: project_id
      - name: series_uid
      - name: case_ids
    injecting_props:
      dataset:
        props:
          - name: _dataset_id
            src: id
            fn: set
      case:
        props:
          - name: _case_id
            src: id
            fn: set
      imaging_study:
        props:
          - name: _imaging_study_id
            src: id
            fn: set
