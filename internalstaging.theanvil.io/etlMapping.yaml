mappings:
  - name: etl_internalstaging-anvil
    doc_type: case
    type: aggregator
    root: case
    props:
      - name: submitter_id
      - name: project_id
      - name: dbgap_study_id
    flatten_props:
      - path: demographics
        props:
          - name: sex
          - name: race
          - name: ethnicity
          - name: ancestry
          - name: age
      - path: death_records
        props:
          - name: hardy_scale
    aggregated_props:
      - name: disease_description
        path: phenotypes
        src: disease_description
        fn: set
      - name: hpo_present
        path: phenotypes
        src: hpo_present
        fn: set
      - name: hpo_absent
        path: phenotypes
        src: hpo_absent
        fn: set
      - name: disease_omim_id
        path: phenotypes
        src: disease_omim_id
        fn: set
      - name: solve_state
        path: phenotypes
        src: solve_state 
        fn: set
      - name: congenital_status
        path: phenotypes
        src: congenital_status
        fn: set
      - name: age_of_onset
        path: phenotypes
        src: age_of_onset
        fn: set      
      - name: sample_source
        path: samples
        src: sample_source
        fn: set
      - name: sample_provider
        path: samples
        src: sample_provider
        fn: set
      - name: inheritance_description
        path: samples.discoveries
        src: inheritance_description
        fn: set
      - name: zygosity
        path: samples.discoveries
        src: zygosity
        fn: set
      - name: significance
        path: samples.discoveries
        src: significance
        fn: set
      - name: gene_class
        path: samples.discoveries
        src: gene_class
        fn: set
      - name: exome_capture_platform
        path: samples.aliquots.read_groups
        src: exome_capture_platform
        fn: set
      - name: library_prep_kit_method
        path: samples.aliquots.read_groups
        src: library_prep_kit_method
        fn: set
      - name: capture_region_bed_file
        path: samples.aliquots.read_groups
        src: capture_region_bed_file
        fn: set
      - name: reference_genome_build
        path: samples.aliquots.read_groups
        src: reference_genome_build
        fn: set
      - name: sequencing_assay
        path: samples.aliquots.read_groups
        src: sequencing_assay
        fn: set
      - name: alignment_method
        path: samples.aliquots.read_groups
        src: alignment_method
        fn: set
      - name: data_processing_pipeline
        path: samples.aliquots.read_groups
        src: data_processing_pipeline
        fn: set
      - name: _samples_count
        path: samples
        fn: count
      - name: ischemic_time
        path: samples
        src: ischemic_time
        fn: set
      - name: _aliquots_count
        path: samples.aliquots
        fn: count
      - name: _read_groups_count
        path: samples.aliquots.read_groups
        fn: count
      - name: _submitted_aligned_reads_count
        path: samples.aliquots.read_groups.submitted_aligned_reads_files
        fn: count
    joining_props:
      - index: file
        join_on: case_id
        props:
          - name: data_format
            src: data_format
            fn: set
          - name: data_type
            src: data_type
            fn: set
  - name: file_internalstaging-anvil
    doc_type: file
    type: collector
    root: None
    category: data_file
    props:
      - name: object_id
      - name: md5sum
      - name: file_name
      - name: file_size
      - name: data_format
      - name: data_type
      - name: state
    injecting_props:
      case:
        props:
          - name: case_id
            src: id
          - name: project_id
