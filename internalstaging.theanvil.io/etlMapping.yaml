mappings:
  - name: etl_internalstaging-anvil
    doc_type: subject
    type: aggregator
    root: subject
    props:
      - name: submitter_id
      - name: project_id
      - name: dbgap_accession_number
      - name: short_name
      - name: dbgap_consent_text
      - name: sex
      - name: age_value
      - name: ancestry
      - name: disease_description
      - name: phenotype_present
      - name: phenotype_absent
      - name: disease_id
      - name: solve_state
      - name: congenital_status
      - name: age_of_onset
      - name: hardy_scale
    flatten_props:
      - path: samples
        props:
          - name: hardy_scale
          - name: sample_provider
          - name: tissue_affected_status
          - name: tissue_type
          - name: sample_type
          - name: original_material_type
    aggregated_props:
      - name: exome_capture_platform
        path: samples.sequencings
        src: exome_capture_platform
        fn: set
      - name: library_prep_kit_method
        path: samples.sequencings
        src: library_prep_kit_method
        fn: set
      - name: capture_region_bed_file
        path: samples.sequencings
        src: capture_region_bed_file
        fn: set
      - name: reference_genome_build
        path: samples.sequencings
        src: reference_genome_build
        fn: set
      - name: sequencing_assay
        path: samples.sequencings
        src: sequencing_assay
        fn: set
      - name: alignment_method
        path: samples.sequencings
        src: alignment_method
        fn: set
      - name: data_processing_pipeline
        path: samples.sequencings
        src: data_processing_pipeline
        fn: set
      - name: _samples_count
        path: samples
        fn: count
      - name: _sequencings_count
        path: samples.sequencings
        fn: count
    joining_props:
      - index: file
        join_on: subject_id
        props:
          - name: data_format
            src: data_format
            fn: set
          - name: data_type
            src: data_type
            fn: set
  - name: file_internalstaging-anvil
    doc_type: file
    type: collector
    root: None
    category: data_file
    props:
      - name: object_id
      - name: md5sum
      - name: file_name
      - name: file_size
      - name: data_format
      - name: data_type
      - name: state
    injecting_props:
      subject:
        props:
          - name: subject_id
            src: id
          - name: project_id
