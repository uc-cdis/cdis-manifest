# Core Gen3 Release 2023.04 (Rhodonite)

## uc-cdis/fence

#### Bug Fixes
  - Fix `fence-create google-bucket-create` when the project does not exist 
    ([#1077](https://github.com/uc-cdis/fence/pull/1077))
  - Fix "non-unique client name" migration to delete all the "unique client 
    name" constraints it finds, instead of assuming there is exactly one 
    ([#1075](https://github.com/uc-cdis/fence/pull/1075))

#### Improvements
  - Add project id format check in usersync ([#1067](https://github.com/uc-cdis/fence/pull/1067)) 

#### Dependency Updates
  - various updates to cryptography/future/pyjwt ([#1073](https://github.com/uc-cdis/fence/pull/1073)) 

## uc-cdis/guppy

#### Improvements
  - vulnerability fixes ([#167](https://github.com/uc-cdis/guppy/pull/167))

## uc-cdis/hatchery

#### Improvements
  - vulnerability fixes ([#56](https://github.com/uc-cdis/hatchery/pull/56))

## uc-cdis/pelican

#### New Features
  - Pelican export: store the generated PFB files' `_expires_at` timestamp in 
    MDS (set to 14 days after creation) so they can be deleted once expired 
    ([#69](https://github.com/uc-cdis/pelican/pull/69))

#### Breaking Changes
  - The Pelican export job now requires access to submit data in MDS. In 
    cloud-automation setups, run `kubectl delete secrets 
    pelicanservice-g3auto`, `rm Gen3Secrets/g3auto/pelicanservice/config.json` 
    and `gen3 kube-setup-pelicanjob`. Then, grant the `pelican-export-job` 
    client access to `(resource=/mds_gateway, method=access, 
    service=mds_gateway)` in the `user.yaml`. ([#69](https://github.com/uc-cdis/pelican/pull/69)) 

#### Deployment Changes
  - The Pelican export job should now be deployed alongside the 
    `metadata-delete-expired-objects` cronjob: add 
    `"metadata-delete-expired-objects": 
    "quay.io/cdis/metadata-delete-expired-objects:<version>"` to the `versions` 
    block of the manifest, run `gen3 
    kube-setup-metadata-delete-expired-objects-cronjob` and grant the 
    `metadata-delete-expired-objects-job` client access to 
    `(resource=/mds_gateway, method=access, service=mds_gateway)` and 
    `(resource=/programs, method=delete, service=fence)` in the `user.yaml`. 
    ([#69](https://github.com/uc-cdis/pelican/pull/69))

## uc-cdis/peregrine

#### New Features
  - Add the `/coremetadata` endpoint, replacing the `pidgin` service ([#198](https://github.com/uc-cdis/peregrine/pull/198)) 

#### Improvements
  - Improve the format of the citation automatically generated by the 
    `/coremetadata` endpoint ([#198](https://github.com/uc-cdis/peregrine/pull/198)) 
  - Use central github workflow actions for image build and push ([#192](https://github.com/uc-cdis/peregrine/pull/192)) 

#### Deployment Changes
  - The `pidgin` service can be removed. Its functionalities are available at 
    peregrine's `/coremetadata` endpoint ([#198](https://github.com/uc-cdis/peregrine/pull/198)) 
  - ASK AN ADMINISTRATOR TO DELETE THE PIDGIN DEPLOYMENT if you remove pidgin. 
    This is NOT automatic ([#198](https://github.com/uc-cdis/peregrine/pull/198)) 

## uc-cdis/pidgin

#### Deployment Changes
  - If you are seeing this message, you are deploying the Pidgin service after 
    it has been deprecated. If you are using Peregrine version 3.2.0/2023.04 or 
    newer, the Pidgin service can and should be removed. ([#48](https://github.com/uc-cdis/pidgin/pull/48)) 

#### Dependency Updates
  - Python 3.9 ([#46](https://github.com/uc-cdis/pidgin/pull/46))

## uc-cdis/data-portal

#### Bug Fixes
  - Fixed a popup height issue ([#1250](https://github.com/uc-cdis/data-portal/pull/1250)) 
  - Fixed an issue that some urls may have double slash in them ([#1250](https://github.com/uc-cdis/data-portal/pull/1250)) 
  - fix for spinner for manifest button not showing until the count ([#1234](https://github.com/uc-cdis/data-portal/pull/1234)) 

#### New Features
  - This adds 500ms debouncing to the HEAL search functionality following page 
    load. This uses the lodash debounce API (this library is already included 
    in the code base). ([#1232](https://github.com/uc-cdis/data-portal/pull/1232)) 
  - This also adds a unit test for the debouncing functionality. ([#1232](https://github.com/uc-cdis/data-portal/pull/1232)) 
  - Change workspace registration title and url location ([#1249](https://github.com/uc-cdis/data-portal/pull/1249)) 
  - Fixed storybook for CustomDichotomousCovariates following the component's 
    interface changes in https://github.com/uc-cdis/data-portal/pull/1204 
    ([#1246](https://github.com/uc-cdis/data-portal/pull/1246))
  - Adds unit tests for CohortsOverlapDiagram, including mocking of 
    web-services ([#1246](https://github.com/uc-cdis/data-portal/pull/1246))
  - This updates the Euler diagram to be more accessible, and include both a 
    text version and a legend. ([#1246](https://github.com/uc-cdis/data-portal/pull/1246)) 
  - Add uid query param to GWASJob.jsx endpoints to support archived workflows 
    ([#1246](https://github.com/uc-cdis/data-portal/pull/1246))
  - Add new temporary entry to VA QA, for testing the new GWAS Results Viewer 
    App features ([#1246](https://github.com/uc-cdis/data-portal/pull/1246))
  - Updates the code base associated with the GWASApp and GWASResults 
    application by cleaning up unneeded CSS styles and changing the names of 
    files and selectors from GWASV2 to GWASApp. ([#1246](https://github.com/uc-cdis/data-portal/pull/1246)) 

#### Improvements
  - A utils folder has been added containing a Search folder to house the 
    search functionality and to aid in code organization. The filtering 
    functions associated with searching have been moved into this folder to 
    help clean up Discovery.tsx. Unneeded imports were removed from 
    Discovery.tsx. ([#1232](https://github.com/uc-cdis/data-portal/pull/1232))
  - Added code to add new tab for COVID-19 Community Analysis tab in which we 
    have three dashboards created in AWS Quicksight embed into Chicagoland 
    Pandemic Response Commons ([#1159](https://github.com/uc-cdis/data-portal/pull/1159)) 
  - changes the System Use message to a scrollable div with the accept button 
    located at the bottom of the scrolled content. ([#1219](https://github.com/uc-cdis/data-portal/pull/1219)) 
  - optionally show the System Use message after user login ([#1219](https://github.com/uc-cdis/data-portal/pull/1219)) 

#### Screen Shots
  - With a 500ms debounce ([#1232](https://github.com/uc-cdis/data-portal/pull/1232)) 
  - Note that when typing a longer query, such as "intersection" it only 
    searches _once_ ([#1232](https://github.com/uc-cdis/data-portal/pull/1232))
  - ![output](https://user-images.githubusercontent.com/113449836/218203865-cb472065-e475-4093-b61e-54c2958a711a.gif)
    ([#1232](https://github.com/uc-cdis/data-portal/pull/1232))

#### Changes
  - Moved COVID-19 Community Analysis Tab to the first position as requested by 
    Bob ([#1241](https://github.com/uc-cdis/data-portal/pull/1241))

## uc-cdis/sower-jobs

#### Breaking Changes
  - update batch export job for MDS v3 AggMDS response syntax ([#43](https://github.com/uc-cdis/sower-jobs/pull/43)) 

